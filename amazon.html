<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abella Joias | Catálogo Enterprise</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --gold: #caa85c; --dark: #1a1a1a; --light: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background-color: var(--light); color: var(--dark); }
        .serif { font-family: 'Cinzel', serif; }
        
        .app-container { display: grid; grid-template-columns: 280px 1px 1fr; min-height: 100vh; }
        .sidebar { position: sticky; top: 80px; height: calc(100vh - 80px); overflow-y: auto; }

        /* Estilo das Imagens para garantir que apareçam */
        .img-wrapper { 
            width: 100%; 
            aspect-ratio: 1/1; 
            background: #f1f1f1; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            overflow: hidden;
            border-radius: 1.5rem;
        }
        .img-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        
        .product-card:hover img { transform: scale(1.1); }

        .cat-link { 
            padding: 12px; border-radius: 12px; font-size: 13px; font-weight: 500; 
            color: #666; transition: 0.3s; display: flex; align-items: center; gap: 12px;
            margin-bottom: 6px; border: 1px solid transparent;
        }
        .cat-link img { width: 35px; height: 35px; border-radius: 8px; object-fit: cover; background: #eee; }
        .cat-link:hover, .cat-link.active { background: #fff; color: var(--gold); border-color: #eee; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }

        .qty-control { display: grid; grid-template-columns: 35px 1fr 35px; border: 1px solid #eee; border-radius: 12px; overflow: hidden; background: #fff; }
        .qty-btn { height: 38px; display: flex; align-items: center; justify-content: center; transition: 0.2s; cursor: pointer; }
        .qty-btn:hover { background: var(--dark); color: #fff; }
    </style>
</head>
<body>

<header class="h-[80px] bg-white border-b border-gray-100 sticky top-0 z-[200] px-6">
    <div class="max-w-[1800px] mx-auto h-full flex items-center justify-between">
        <div class="flex flex-col">
            <span class="serif text-xl font-bold tracking-[3px] text-gray-900 uppercase">Abella Joias</span>
            <span class="text-[9px] tracking-[4px] text-gray-400 font-bold uppercase">Joias no Bruto Premium</span>
        </div>

        <div class="flex items-center gap-6">
            <div class="bg-black text-white px-6 py-3 rounded-2xl flex items-center gap-3">
                <i class="fas fa-shopping-bag text-[#caa85c]"></i>
                <span id="header-total" class="text-xs font-bold">R$ 0,00</span>
            </div>
        </div>
    </div>
</header>

<div class="max-w-[1800px] mx-auto app-container">
    <aside class="sidebar p-6 bg-[#fafafa]">
        <h3 class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-6">Coleções</h3>
        <nav id="listCategorias">
            </nav>
    </aside>

    <div class="bg-gray-200/50 w-[1px]"></div>

    <main class="p-8 pb-32">
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            </div>
    </main>
</div>

<footer class="fixed bottom-0 w-full bg-white border-t border-gray-100 p-6 z-[300] shadow-lg">
    <div class="max-w-[1800px] mx-auto flex items-center justify-between">
        <div class="flex flex-col">
            <span class="text-[10px] text-gray-400 font-bold uppercase">Investimento Total</span>
            <span id="footer-total" class="text-2xl font-black text-[#caa85c]">R$ 0,00</span>
        </div>
        <button id="btn-whats" onclick="enviarWhatsApp()" class="bg-black text-white px-10 py-4 rounded-2xl font-bold uppercase text-[11px] tracking-widest hover:bg-[#caa85c] transition-all">
            Finalizar via WhatsApp
        </button>
    </div>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
        databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allProducts = [];
    let cart = JSON.parse(localStorage.getItem('abella_cart') || '{}');
    const IMG_FALLBACK = "https://via.placeholder.com/400?text=Abella+Joias";

    const fM = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    function init() {
        carregarCategorias();
        carregarProdutos();
        atualizarUI();
    }

    function carregarCategorias() {
        db.ref('categories').on('value', snap => {
            const container = document.getElementById('listCategorias');
            container.innerHTML = `<a href="javascript:void(0)" onclick="filtrar('all')" class="cat-link active" id="cat-all">
                <div class="w-[35px] h-[35px] bg-gray-200 rounded-lg flex items-center justify-center text-[10px] font-bold">ALL</div>
                <span>Todos os Brutos</span>
            </a>`;
            
            snap.forEach(s => {
                const cat = s.val();
                if (cat.paused) return;
                
                // Forçamos o uso do campo 'image' da categoria
                const imgUrl = cat.image || cat.imageUrl || IMG_FALLBACK;
                
                container.innerHTML += `
                    <a href="javascript:void(0)" onclick="filtrar('${s.key}')" class="cat-link" id="cat-${s.key}">
                        <img src="${imgUrl}" onerror="this.src='${IMG_FALLBACK}'">
                        <span class="truncate">${cat.name}</span>
                    </a>`;
            });
        });
    }

    function carregarProdutos() {
        db.ref('products').on('value', snap => {
            allProducts = [];
            snap.forEach(s => {
                const p = s.val();
                allProducts.push({id: s.key, ...p});
            });
            renderizar(allProducts);
        });
    }

    function renderizar(items) {
        const grid = document.getElementById('product-grid');
        grid.innerHTML = items.map(p => {
            // Verifica o campo exato da imagem no seu banco
            const imgUrl = p.image || p.imageUrl || p.thumb || IMG_FALLBACK;
            
            return `
                <div class="product-card bg-white p-4 rounded-[2rem] border border-gray-50 group">
                    <div class="img-wrapper mb-5">
                        <img src="${imgUrl}" onerror="this.src='${IMG_FALLBACK}'" loading="lazy">
                    </div>
                    
                    <h3 class="text-xs font-bold text-gray-800 uppercase line-clamp-1 mb-1">${p.name}</h3>
                    <p class="text-[9px] text-gray-400 font-bold mb-4 tracking-widest">REF: ${p.id.substring(0,8).toUpperCase()}</p>
                    
                    <div class="flex items-center justify-between">
                        <span class="text-base font-black text-gray-900">${fM(p.price || 0)}</span>
                        
                        <div class="qty-control w-24">
                            <button onclick="updateCart('${p.id}', -1, ${p.price}, '${p.name.replace(/'/g, "")}')" class="qty-btn"><i class="fas fa-minus text-[9px]"></i></button>
                            <div class="flex items-center justify-center text-xs font-black">${cart[p.id]?.qty || 0}</div>
                            <button onclick="updateCart('${p.id}', 1, ${p.price}, '${p.name.replace(/'/g, "")}')" class="qty-btn"><i class="fas fa-plus text-[9px]"></i></button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function updateCart(id, delta, price, name) {
        if(!cart[id]) cart[id] = { qty: 0, price, name };
        cart[id].qty = Math.max(0, cart[id].qty + delta);
        if(cart[id].qty === 0) delete cart[id];
        
        localStorage.setItem('abella_cart', JSON.stringify(cart));
        atualizarUI();
        renderizar(allProducts);
    }

    function atualizarUI() {
        let total = 0;
        for(let k in cart) total += cart[k].qty * cart[k].price;
        document.getElementById('header-total').innerText = fM(total);
        document.getElementById('footer-total').innerText = fM(total);
    }

    function filtrar(catId) {
        document.querySelectorAll('.cat-link').forEach(l => l.classList.remove('active'));
        document.getElementById('cat-'+catId).classList.add('active');
        
        if(catId === 'all') renderizar(allProducts);
        else renderizar(allProducts.filter(p => p.category === catId));
    }

    function enviarWhatsApp() {
        let msg = `*PEDIDO ABELLA JOIAS*\n\n`;
        for(let k in cart) msg += `• ${cart[k].qty}x ${cart[k].name}\n`;
        msg += `\n*TOTAL: ${document.getElementById('footer-total').innerText}*`;
        window.open(`https://wa.me/5511999999999?text=${encodeURIComponent(msg)}`);
    }

    window.onload = init;
</script>
</body>
</html>
