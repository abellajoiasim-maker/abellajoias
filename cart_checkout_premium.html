<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carrinho | Abella Joias</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
body{font-family:'Poppins',sans-serif;background:#fcfaf7;margin:0;}
.header{padding:1rem;text-align:center;background:white;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.btn{padding:0.5rem 1rem;border-radius:9999px;font-weight:600;text-xs;transition:0.2s;cursor:pointer;}
.btn-black{background:black;color:white;}
.btn-gold{border:2px solid #d4af37;color:#b8860b;}
.card{border:1px solid #eee;border-radius:16px;padding:1rem;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 12px rgba(212,175,55,0.15);}
.total{font-weight:700;text-right;margin-top:1rem;}
</style>
</head>
<body>
<header class="header">
<h1 class="text-xl font-bold">Meu Carrinho</h1>
</header>
<main class="max-w-4xl mx-auto p-4">
  <div id="carrinhoProdutos"></div>
  <div class="total">Total: R$ <span id="totalCart">0.00</span></div>
  <div class="flex gap-2 mt-4">
    <button id="finalizar" class="btn btn-black flex-1">Finalizar Pedido</button>
    <button id="romaneio" class="btn btn-gold flex-1">Gerar Romaneio / Imprimir</button>
  </div>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
  storageBucket: "catalogo-abella-joias.firebasestorage.app",
  messagingSenderId: "727568435294",
  appId: "1:727568435294:web:442c0179ecf0686dff4ccf"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
const carrinhoDiv = document.getElementById('carrinhoProdutos');
const totalSpan = document.getElementById('totalCart');

function atualizarCarrinho(){
  let total=0;
  carrinhoDiv.innerHTML='';
  carrinho.forEach((p,i)=>{
    total+=Number(p.preco)*p.qty;
    carrinhoDiv.innerHTML+=`
      <div class="card">
        <div>${p.qty}x ${p.name} - R$ ${p.preco}</div>
        <div><button onclick="removerProduto(${i})" class="btn btn-gold text-xs">Remover</button></div>
      </div>`;
  });
  totalSpan.textContent=total.toFixed(2);
}
function removerProduto(i){carrinho.splice(i,1);localStorage.setItem('carrinho',JSON.stringify(carrinho));atualizarCarrinho();}
atualizarCarrinho();

document.getElementById('finalizar').onclick=()=>{
  const nome = prompt("Nome do Cliente:");
  const whatsapp = prompt("WhatsApp:");
  if(!nome || !whatsapp) return alert("Informe nome e WhatsApp!");
  db.ref('orders').push({cliente:nome,whatsapp,itens:carrinho,total:carrinho.reduce((a,b)=>a+b.preco*b.qty,0),pagamento:"PIX",status:"Novo"});
  localStorage.removeItem('carrinho'); carrinho=[]; atualizarCarrinho();
  alert("Pedido finalizado!");
};

document.getElementById('romaneio').onclick=()=>{
  let win = window.open('', '_blank');
  let html = `<html><head><title>Romaneio de Pedidos</title>
  <style>body{font-family:Poppins,sans-serif;}h1{text-align:center;}table{width:100%;border-collapse:collapse;margin-top:20px;}td,th{border:1px solid #222;padding:8px;text-align:left;}th{background:#d4af37;color:white;}</style>
  </head><body><h1>Romaneio de Pedidos</h1><table><tr><th>Produto</th><th>Qtd</th><th>Pre√ßo</th></tr>`;
  carrinho.forEach(p=>html+=`<tr><td>${p.name}</td><td>${p.qty}</td><td>R$ ${p.preco}</td></tr>`);
  html+=`</table></body></html>`;
  win.document.write(html); win.document.close(); win.print();
};
</script>
</body>
</html>
