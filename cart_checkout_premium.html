<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carrinho | Abella Joias</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<style>
body{font-family:'Poppins',sans-serif;background:#fcfaf7}
img.aspect-square{aspect-ratio:1/1;object-fit:cover}
</style>
</head>
<body>
<header class="bg-white shadow-sm py-6 text-center border-b-2 border-[#d4af37]">
<h1 class="text-2xl font-bold text-gray-800">MEU CARRINHO</h1>
<a href="index.html" class="text-xs text-[#b8860b] hover:underline">← Voltar à loja</a>
</header>

<main class="max-w-4xl mx-auto p-6 space-y-4">
<div id="cartList" class="space-y-4"></div>
<div class="flex justify-between font-semibold text-lg">
<span>Total:</span><span id="cartTotal">R$ 0.00</span>
</div>
<button id="checkoutBtn" class="w-full bg-black text-white px-4 py-3 rounded">Finalizar Compra</button>
</main>

<script>
const firebaseConfig={apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",authDomain:"catalogo-abella-joias.firebaseapp.com",databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com",projectId:"catalogo-abella-joias"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let cart=JSON.parse(localStorage.getItem('abellaCart')||'[]');
const cartList=document.getElementById('cartList'), cartTotal=document.getElementById('cartTotal');

function renderCart(){
 if(cart.length===0){cartList.innerHTML='<p>Carrinho vazio</p>'; cartTotal.textContent='R$ 0.00'; return;}
 cartList.innerHTML='';
 let total=0;
 db.ref('products').once('value').then(snap=>{
   snap.forEach(s=>{
     const p=s.val(); const c=cart.find(x=>x.id===s.key);
     if(c){
       const subtotal=p.price*c.qty;
       total+=subtotal;
       cartList.innerHTML+=`<div class="flex gap-4 items-center border p-2 rounded">
         <img src="${p.image}" class="w-20 h-20 aspect-square rounded">
         <div class="flex-1">
           <p class="font-semibold">${p.name}</p>
           <p class="text-xs">R$ ${p.price.toFixed(2)} x ${c.qty}</p>
           <p class="font-bold">Subtotal: R$ ${subtotal.toFixed(2)}</p>
           <div class="flex gap-2 mt-1">
             <button onclick="changeQty('${s.key}',-1)" class="px-2 py-1 border rounded text-xs">-</button>
             <button onclick="changeQty('${s.key}',1)" class="px-2 py-1 border rounded text-xs">+</button>
             <button onclick="removeItem('${s.key}')" class="px-2 py-1 border rounded text-xs text-red-600">Remover</button>
           </div>
         </div>
       </div>`;
     }
   });
   cartTotal.textContent='R$ '+total.toFixed(2);
 });
}

function changeQty(id,delta){cart=cart.map(p=>p.id===id?{...p,qty:p.qty+delta}:p).filter(p=>p.qty>0);localStorage.setItem('abellaCart',JSON.stringify(cart));renderCart();}
function removeItem(id){cart=cart.filter(p=>p.id!==id);localStorage.setItem('abellaCart',JSON.stringify(cart));renderCart();}

renderCart();
</script>
</body>
</html>
