<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#faf9f7}
.font-serif{font-family:'Cinzel',serif}
.gold{color:#A68966}
</style>
</head>

<body>

<header class="bg-white border-b p-6 text-center">
  <h1 class="font-serif text-2xl tracking-widest gold">Abella Joias</h1>
  <p class="text-xs tracking-widest text-gray-400 uppercase">CatÃ¡logo Oficial</p>
</header>

<!-- CATEGORIAS -->
<section class="max-w-6xl mx-auto px-4 py-4">
  <div id="filtroCategorias" class="flex gap-3 flex-wrap justify-center"></div>
</section>

<!-- PRODUTOS -->
<section class="max-w-6xl mx-auto px-4 pb-32">
  <div id="listaProdutos" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
</section>

<!-- BOTÃƒO CARRINHO -->
<a href="checkout.html"
   class="fixed bottom-6 right-6 bg-black text-white px-6 py-3 rounded-full text-xs tracking-widest shadow-lg">
ðŸ›’ Finalizar Pedido
</a>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias"
});
const db = firebase.database();

let produtos = [];
let categoriaAtiva = 'Todos';
let carrinho = JSON.parse(localStorage.getItem('cart')) || [];

/* CATEGORIAS */
db.ref('categories').on('value', snap => {
  const wrap = document.getElementById('filtroCategorias');
  wrap.innerHTML = '';

  criarBtnCategoria('Todos', wrap);

  snap.forEach(s => criarBtnCategoria(s.val().name, wrap));
});

function criarBtnCategoria(nome, wrap){
  const b = document.createElement('button');
  b.textContent = nome;
  b.className = 'px-4 py-2 border text-xs';
  b.onclick = () => {
    categoriaAtiva = nome;
    renderProdutos();
  };
  wrap.appendChild(b);
}

/* PRODUTOS */
db.ref('products').on('value', snap => {
  produtos = [];
  snap.forEach(s => produtos.push({id:s.key, ...s.val()}));
  renderProdutos();
});

/* RENDER */
function renderProdutos(){
  const lista = document.getElementById('listaProdutos');
  lista.innerHTML = '';

  produtos
    .filter(p => categoriaAtiva === 'Todos' || p.category === categoriaAtiva)
    .forEach(p => {
      lista.innerHTML += `
      <div class="bg-white border hover:shadow-md transition">
        <img src="${p.image}" class="w-full aspect-square object-cover">
        <div class="p-3 space-y-1">
          <p class="text-sm font-medium">${p.name}</p>
          <p class="text-xs text-gray-400">${p.category}</p>
          <p class="gold font-semibold">R$ ${p.price.toFixed(2)}</p>

          <button onclick='addCarrinho(${JSON.stringify(p)})'
            class="w-full mt-2 border text-xs py-2 hover:bg-black hover:text-white">
            ADICIONAR
          </button>
        </div>
      </div>`;
    });
}

/* CARRINHO */
function addCarrinho(p){
  const item = carrinho.find(i => i.id === p.id);
  if(item) item.qty++;
  else carrinho.push({...p, qty:1});

  localStorage.setItem('cart', JSON.stringify(carrinho));
  alert('Produto adicionado ao carrinho');
}
</script>

</body>
</html>
