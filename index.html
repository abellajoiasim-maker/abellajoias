<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#F8F6F2}
.font-serif{font-family:'Cinzel',serif}
.gold{color:#A68966}
</style>
</head>

<body>

<header class="bg-white border-b px-8 py-6 flex justify-between items-center">
  <h1 class="font-serif text-xl tracking-widest gold">Abella Joias</h1>
  <button onclick="abrirCarrinho()" class="text-sm">ðŸ›’ Carrinho (<span id="qtdCarrinho">0</span>)</button>
</header>

<main class="max-w-6xl mx-auto p-8">
  <div id="listaProdutos" class="grid grid-cols-2 md:grid-cols-4 gap-6"></div>
</main>

<!-- CARRINHO -->
<div id="modalCarrinho" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
  <div class="bg-white w-full max-w-md p-6 space-y-4">
    <h2 class="font-serif gold text-lg">Carrinho</h2>

    <div id="itensCarrinho" class="space-y-2"></div>

    <p class="text-sm">Peso total: <strong><span id="pesoTotal">0</span>g</strong></p>
    <p class="text-sm">Total: <strong>R$ <span id="totalCarrinho">0.00</span></strong></p>

    <div class="flex gap-2">
      <button onclick="finalizar()" class="bg-black text-white px-4 py-2 text-xs flex-1">Finalizar</button>
      <button onclick="fecharCarrinho()" class="border px-4 py-2 text-xs">Fechar</button>
    </div>
  </div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias"
});

const db=firebase.database();
const listaProdutos=document.getElementById('listaProdutos');

let carrinho=JSON.parse(localStorage.getItem('carrinho')||'[]');
atualizarCarrinho();

/* CONFIGURAÃ‡Ã•ES DA LOJA */
let descontoPix=0;
let parcelas=1;

db.ref('settings').once('value').then(s=>{
  if(!s.val())return;
  descontoPix=Number(s.val().pix||0);
  parcelas=Number(s.val().parcelas||1);
});

/* PRODUTOS */
db.ref('products').on('value',snap=>{
  listaProdutos.innerHTML='';
  snap.forEach(s=>{
    const p=s.val();

    const precoPix=(p.price*(1-descontoPix/100)).toFixed(2);
    const parcela=(p.price/parcelas).toFixed(2);

    listaProdutos.innerHTML+=`
      <div class="bg-white border p-3 space-y-2">
        <img src="${p.image}" class="aspect-square object-cover">
        <p class="text-sm">${p.name}</p>

        <p class="text-xs">ðŸ’³ ${parcelas}x R$ ${parcela}</p>
        <p class="text-xs text-green-700">âš¡ PIX R$ ${precoPix}</p>
        <p class="font-semibold gold">R$ ${p.price.toFixed(2)}</p>

        <button onclick='addCarrinho(${JSON.stringify(p)})'
          class="bg-black text-white w-full text-xs py-2">Adicionar ao carrinho</button>
      </div>
    `;
  });
});

/* CARRINHO */
function addCarrinho(p){
  const item=carrinho.find(i=>i.sku===p.sku);
  if(item) item.qty++;
  else carrinho.push({...p,qty:1});
  salvarCarrinho();
}

function salvarCarrinho(){
  localStorage.setItem('carrinho',JSON.stringify(carrinho));
  atualizarCarrinho();
}

function atualizarCarrinho(){
  document.getElementById('qtdCarrinho').textContent=
    carrinho.reduce((s,i)=>s+i.qty,0);
}

function abrirCarrinho(){
  const lista=document.getElementById('itensCarrinho');
  let total=0,peso=0;
  lista.innerHTML='';

  carrinho.forEach(i=>{
    total+=i.price*i.qty;
    peso+=(i.weight||0)*i.qty;
    lista.innerHTML+=`
      <div class="flex justify-between text-xs">
        <span>${i.name} (${i.qty})</span>
        <span>R$ ${(i.price*i.qty).toFixed(2)}</span>
      </div>
    `;
  });

  document.getElementById('totalCarrinho').textContent=total.toFixed(2);
  document.getElementById('pesoTotal').textContent=peso;

  document.getElementById('modalCarrinho').classList.remove('hidden');
}

function fecharCarrinho(){
  document.getElementById('modalCarrinho').classList.add('hidden');
}

/* FINALIZAR */
function finalizar(){
  location.href="checkout.html";
}
</script>

</body>
</html>
