<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abella Joias | Atacado</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#f8f6f2;font-family:serif}
.gold{color:#a88958}
.gold-border{border-color:#a88958}
.card{transition:.3s}
.card:hover{transform:translateY(-6px)}
</style>
</head>

<body>

<!-- HEADER -->
<header class="bg-white border-b p-6 text-center sticky top-0 z-50">
  <h1 class="text-2xl gold font-bold tracking-wide">Abella Joias</h1>
  <p class="text-xs text-gray-500 tracking-widest mt-1">
    ATACADO DE JOIAS NO BRUTO
  </p>

  <div class="flex justify-center gap-3 mt-4 text-xs">
    <a href="galvanicas.html"
       class="border gold-border px-4 py-2 rounded-full hover:bg-black hover:text-white">
      GALVÂNICAS
    </a>
    <button onclick="abrirCarrinho()"
       class="border gold-border px-4 py-2 rounded-full hover:bg-black hover:text-white">
      CARRINHO (<span id="qtdCarrinho">0</span>)
    </button>
    <button onclick="history.back()"
       class="border gold-border px-4 py-2 rounded-full hover:bg-black hover:text-white">
      VOLTAR
    </button>
  </div>
</header>

<!-- CATEGORIAS -->
<section id="categorias"
 class="p-4 grid grid-cols-2 md:grid-cols-4 gap-4"></section>

<!-- PRODUTOS -->
<main id="produtos"
 class="p-4 grid grid-cols-2 md:grid-cols-4 gap-4"></main>

<!-- CARRINHO -->
<div id="carrinho"
 class="fixed inset-0 bg-black/60 hidden z-50">
  <div class="bg-white max-w-md ml-auto h-full p-5 flex flex-col">

    <div class="flex justify-between mb-4">
      <h2 class="gold text-lg">Carrinho</h2>
      <button onclick="fecharCarrinho()">✖</button>
    </div>

    <div id="listaCarrinho"
     class="flex-1 overflow-auto space-y-3 text-sm"></div>

    <button onclick="fecharCarrinho()"
     class="border mt-4 py-2 rounded-full text-sm">
      ⬅ VOLTAR ÀS COMPRAS
    </button>

    <a href="checkout_premium.html"
     class="bg-black text-white text-center py-3 mt-3 rounded-full text-sm">
      FINALIZAR PEDIDO
    </a>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain:"catalogo-abella-joias.firebaseapp.com",
  databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId:"catalogo-abella-joias"
});
const db=firebase.database();

let produtosDB=[], carrinho=JSON.parse(localStorage.getItem("carrinho")||"[]");

/* CATEGORIAS */
db.ref("categorias").on("value",s=>{
  categorias.innerHTML='';
  s.forEach(c=>{
    const cat={id:c.key,...c.val()};
    categorias.innerHTML+=`
    <div onclick="filtrarCategoria('${cat.nome}')"
      class="relative cursor-pointer card">
      <img src="${cat.imagem}"
       class="w-full aspect-square object-cover rounded-xl">
      <div class="absolute inset-0 bg-black/40 flex items-center
       justify-center rounded-xl">
        <span class="text-white text-sm font-bold">
          ${cat.nome}
        </span>
      </div>
    </div>`;
  });
});

/* PRODUTOS */
db.ref("produtos").on("value",snap=>{
  produtosDB=[];
  produtos.innerHTML='';
  snap.forEach(s=>{
    const p={id:s.key,...s.val()};
    produtosDB.push(p);
  });
  render(produtosDB);
});

function render(lista){
  produtos.innerHTML='';
  lista.forEach(p=>{
    produtos.innerHTML+=`
    <div class="bg-white p-3 border rounded-xl card">
      <img src="${p.imagem}"
       class="w-full aspect-square object-cover mb-2">
      <h3 class="text-sm text-center">${p.nome}</h3>
      <p class="gold text-center font-bold text-sm mt-1">
        R$ ${p.preco}
      </p>
      <button onclick='addCarrinho(${JSON.stringify(p)})'
        class="w-full border mt-2 py-2 rounded-full text-xs
         hover:bg-black hover:text-white">
        ADICIONAR
      </button>
    </div>`;
  });
}

function filtrarCategoria(cat){
  render(produtosDB.filter(p=>p.categoria==cat));
}

/* CARRINHO */
function addCarrinho(p){
  const i=carrinho.find(x=>x.id==p.id);
  if(i)i.qtd++; else carrinho.push({...p,qtd:1});
  salvar();
}
function salvar(){
  localStorage.setItem("carrinho",JSON.stringify(carrinho));
  atualizar();
}
function atualizar(){
  listaCarrinho.innerHTML='';
  let q=0;
  carrinho.forEach((i,idx)=>{
    q+=i.qtd;
    listaCarrinho.innerHTML+=`
    <div class="flex justify-between border-b pb-1">
      <span>${i.nome} x${i.qtd}</span>
      <button onclick="remover(${idx})">✖</button>
    </div>`;
  });
  qtdCarrinho.innerText=q;
}
function remover(i){carrinho.splice(i,1);salvar();}
function abrirCarrinho(){carrinhoDiv().classList.remove("hidden");}
function fecharCarrinho(){carrinhoDiv().classList.add("hidden");}
function carrinhoDiv(){return document.getElementById("carrinho");}
atualizar();
</script>

</body>
</html>
