<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Outlet Atacado | Abella Joias</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #fdfdfd; }
        .serif { font-family: 'Cinzel', serif; }
        .gold { color: #A68966; }
        .bg-promo { background: linear-gradient(135deg, #000 0%, #333 100%); }
        .card-promo { background: white; border-radius: 20px; border: 1px solid #f0f0f0; transition: 0.4s; position: relative; overflow: hidden; }
        .card-promo:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); border-color: #A68966; }
        .badge-discount { position: absolute; top: 15px; left: 15px; background: #ef4444; color: white; padding: 4px 12px; border-radius: 50px; font-size: 10px; font-weight: bold; z-index: 10; }
        /* Modal Style */
        #customModal { backdrop-filter: blur(8px); }
    </style>
</head>
<body>

<div class="bg-promo text-white py-4 px-6 flex justify-between items-center sticky top-0 z-[100]">
    <div class="flex items-center gap-4">
        <a href="index.html" class="text-white/50 hover:text-white">← Voltar</a>
        <h1 class="serif text-lg tracking-[0.2em]">OUTLET B2B</h1>
    </div>
    <div class="hidden md:block text-[10px] tracking-widest font-light text-gray-300">
        OPORTUNIDADES EXCLUSIVAS PARA REVENDA
    </div>
    <button class="bg-[#A68966] text-white px-4 py-2 rounded-full text-[10px] font-bold">
        CARRINHO (<span id="cartCount">0</span>)
    </button>
</div>

<main class="max-w-7xl mx-auto p-6 md:p-12">
    <div class="text-center mb-12">
        <span class="text-[#A68966] font-bold text-xs tracking-[0.3em] uppercase">Ofertas por Categoria</span>
        <h2 class="serif text-3xl text-gray-900 mt-2 italic">Aproveite o Melhor do Bruto</h2>
        <div id="filterTags" class="flex flex-wrap justify-center gap-2 mt-6">
            <button onclick="carregarPromo('TODOS')" class="px-6 py-2 bg-black text-white rounded-full text-[10px] font-bold uppercase shadow-lg">Ver Todos</button>
            <button onclick="carregarPromo('PROMO')" class="px-6 py-2 bg-white border border-gray-200 rounded-full text-[10px] font-bold uppercase hover:bg-red-50">Promoção</button>
            <button onclick="carregarPromo('OFF')" class="px-6 py-2 bg-white border border-gray-200 rounded-full text-[10px] font-bold uppercase hover:bg-orange-50">Ofertas</button>
            <button onclick="carregarPromo('LANÇ')" class="px-6 py-2 bg-white border border-gray-200 rounded-full text-[10px] font-bold uppercase hover:bg-blue-50">Lançamentos</button>
        </div>
    </div>

    <div id="gridPromo" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-10">
        </div>
</main>

<div id="customModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-[200]">
    <div class="bg-white p-8 rounded-[30px] w-[90%] max-w-sm text-center shadow-2xl">
        <div id="modalImgContainer" class="w-24 h-24 mx-auto mb-4 bg-gray-50 rounded-full flex items-center justify-center overflow-hidden border">
            <img id="modalImg" src="" class="object-contain w-full h-full p-2">
        </div>
        <h3 id="modalProductName" class="serif text-lg font-bold text-gray-800 mb-1">Nome</h3>
        <p id="modalSKU" class="text-[10px] text-[#A68966] font-bold mb-6 tracking-widest uppercase">SKU: 000</p>
        
        <div class="bg-gray-50 p-6 rounded-2xl mb-6">
            <label class="block text-[9px] font-bold text-gray-400 uppercase mb-3">Quantidade para Atacado</label>
            <input type="number" id="modalQtyInput" value="1" min="1" 
                   class="w-full text-3xl font-bold text-center bg-transparent border-b-2 border-[#A68966] outline-none pb-2">
        </div>
        
        <div class="flex gap-3">
            <button onclick="closeModal()" class="flex-1 py-4 text-[10px] font-bold uppercase text-gray-400">Fechar</button>
            <button id="confirmBtn" class="flex-[2] py-4 bg-black text-white rounded-2xl text-[10px] font-bold uppercase tracking-widest shadow-xl">Adicionar ao Pedido</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY", databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentProduct = null;

    function carregarPromo(filtroTag = 'TODOS') {
        const grid = document.getElementById('gridPromo');
        grid.innerHTML = '<p class="col-span-full text-center py-20 text-gray-400">Buscando melhores ofertas...</p>';

        db.ref('products').once('value', snap => {
            grid.innerHTML = '';
            let count = 0;

            snap.forEach(child => {
                const p = child.val();
                // Regra: Só exibe se tiver TAG e não estiver pausado
                if (p.paused || !p.tag) return;
                if (filtroTag !== 'TODOS' && p.tag !== filtroTag) return;

                count++;
                const pCheio = parseFloat(p.price);
                const pPix = (pCheio * 0.95).toFixed(2);
                const sugVenda = (pCheio * 3).toFixed(2); // Sugestão de revenda B2B

                grid.innerHTML += `
                <div class="card-promo p-5 flex flex-col justify-between h-full">
                    <span class="badge-discount">${p.tag}</span>
                    <div>
                        <div class="aspect-square mb-6 flex items-center justify-center p-4">
                            <img src="${p.image}" class="max-h-full object-contain">
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[9px] font-bold text-gray-300 uppercase">SKU: ${p.sku}</span>
                            <span class="text-[9px] font-bold text-green-500 uppercase">${p.weight}g</span>
                        </div>
                        <h4 class="text-[12px] font-bold text-gray-800 leading-tight h-10 overflow-hidden mb-4 uppercase">${p.name}</h4>
                        
                        <div class="bg-gray-50 p-3 rounded-xl mb-4 border border-dashed border-gray-200 text-center">
                            <p class="text-[9px] text-gray-400 uppercase font-semibold">Sugestão de Revenda</p>
                            <p class="text-sm font-bold text-green-600">R$ ${sugVenda}</p>
                        </div>

                        <div class="space-y-1 mb-6">
                            <p class="text-[10px] text-gray-400 line-through italic">De: R$ ${(pCheio * 1.2).toFixed(2)}</p>
                            <p class="text-xl font-bold text-black">R$ ${pCheio.toFixed(2)}</p>
                            <p class="text-[11px] font-bold gold">R$ ${pPix} no PIX</p>
                        </div>
                    </div>

                    <button onclick="openModal('${p.sku}', '${p.name.replace(/'/g, "\\'")}', '${p.image}')" 
                            class="w-full bg-black text-white py-4 rounded-2xl text-[10px] font-bold tracking-[0.2em] uppercase hover:bg-[#A68966] transition-all active:scale-95 shadow-lg">
                        ADICIONAR
                    </button>
                </div>`;
            });

            if(count === 0) grid.innerHTML = '<p class="col-span-full text-center py-20 text-gray-400">Nenhuma oferta ativa nesta categoria no momento.</p>';
        });
    }

    // Modal Control
    function openModal(sku, nome, img) {
        currentProduct = { sku, nome };
        document.getElementById('modalProductName').innerText = nome;
        document.getElementById('modalSKU').innerText = "SKU: " + sku;
        document.getElementById('modalImg').src = img;
        document.getElementById('modalQtyInput').value = 1;
        document.getElementById('customModal').classList.remove('hidden');
        
        setTimeout(() => {
            const input = document.getElementById('modalQtyInput');
            input.focus();
            input.select();
        }, 200);
    }

    function closeModal() { document.getElementById('customModal').classList.add('hidden'); }

    document.getElementById('confirmBtn').onclick = function() {
        const qtd = parseInt(document.getElementById('modalQtyInput').value);
        if (qtd > 0) {
            console.log("Adicionado:", currentProduct.nome, qtd);
            closeModal();
            // Feedback
            let cartC = document.getElementById('cartCount');
            cartC.innerText = parseInt(cartC.innerText) + qtd;
        }
    }

    // Iniciar carregando tudo
    carregarPromo('TODOS');
</script>

</body>
</html>
