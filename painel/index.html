<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
body{font-family:Arial;background:#f7f7f7;margin:0}
header{background:#111;color:#fff;padding:15px;text-align:center}
nav{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;background:#222;padding:10px}
nav button{background:#d4af37;border:0;padding:10px 14px;border-radius:20px;cursor:pointer;font-weight:bold}
section{display:none;padding:20px}
section.active{display:block}
.card{background:#fff;padding:10px;margin-bottom:6px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
.card small{color:#666}
input,select{width:100%;padding:8px;margin:4px 0}
button.action{background:#111;color:#fff;border:0;padding:6px 10px;border-radius:6px;cursor:pointer}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal-content{background:#fff;width:95%;max-width:420px;padding:20px;border-radius:12px;max-height:90vh;overflow:auto}
.badge-ok{color:green;font-weight:bold}
.badge-no{color:red;font-weight:bold}
</style>
</head>

<body>

<header>
<h2>PAINEL ADMIN â€” ABELLA JOIAS</h2>
</header>

<nav>
<button onclick="show('empresa')">Empresa</button>
<button onclick="show('categorias')">Categorias</button>
<button onclick="show('produtos')">Produtos</button>
<button onclick="show('promos')">PromoÃ§Ãµes</button>
<button onclick="show('pedidos')">Pedidos</button>
</nav>

<!-- EMPRESA -->
<section id="empresa" class="active">
<h3>Empresa</h3>
<input id="empNome" placeholder="Nome da empresa">
<input id="empWhatsapp" placeholder="WhatsApp">
<input id="empPix" placeholder="Desconto PIX (%)">
<button class="action" onclick="salvarEmpresa()">Salvar</button>
</section>

<!-- CATEGORIAS -->
<section id="categorias">
<h3>Categorias + VariaÃ§Ãµes</h3>
<input id="catNome" placeholder="Nome da categoria">
<button class="action" onclick="addCategoria()">Adicionar</button>
<div id="listaCategorias"></div>
</section>

<!-- PRODUTOS -->
<section id="produtos">
<h3>Produtos</h3>
<select id="filtroCategoria" onchange="carregarProdutos()"></select>
<div id="listaProdutos"></div>
</section>

<!-- PROMO -->
<section id="promos">
<h3>PromoÃ§Ãµes</h3>
<p>(estrutura pronta para reativar sem pesar)</p>
</section>

<!-- PEDIDOS -->
<section id="pedidos">
<h3>Pedidos</h3>
<p>âœ” mantido estÃ¡vel</p>
</section>

<!-- MODAL PRODUTO -->
<div class="modal" id="modalProduto">
<div class="modal-content">
<h3>Editar Produto</h3>
<input id="pNome" placeholder="Nome">
<input id="pSku" placeholder="SKU">
<input id="pPeso" placeholder="Peso">
<input id="pPreco" placeholder="PreÃ§o">
<input id="pImg" placeholder="URL da imagem">
<select id="pCategoria"></select>

<h4>VariaÃ§Ãµes</h4>
<div id="variacoesBox"></div>
<input id="novaVar" placeholder="Nova variaÃ§Ã£o">
<button class="action" onclick="addVariacao()">Adicionar variaÃ§Ã£o</button>

<br><br>
<button class="action" onclick="salvarProduto()">Salvar</button>
<button class="action" onclick="fecharModal()">Fechar</button>
</div>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG â€” SEU PROJETO
firebase.initializeApp({
 apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
 authDomain:"catalogo-abella-joias.firebaseapp.com",
 databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com",
 projectId:"catalogo-abella-joias",
 storageBucket:"catalogo-abella-joias.firebasestorage.app"
});
const db=firebase.database();

let produtoAtual=null;

function show(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 if(id==="categorias") carregarCategorias();
 if(id==="produtos"){carregarCategoriasSelect();carregarProdutos();}
}

function salvarEmpresa(){
 db.ref("empresa").set({
  nome:empNome.value,
  whatsapp:empWhatsapp.value,
  pix:empPix.value
 });
 alert("Empresa salva");
}

/* ================= CATEGORIAS ================= */
function addCategoria(){
 const ref=db.ref("categorias").push();
 ref.set({nome:catNome.value,variacoes:{}});
 catNome.value="";
 carregarCategorias();
}

function carregarCategorias(){
 listaCategorias.innerHTML="";
 db.ref("categorias").once("value").then(s=>{
  s.forEach(c=>{
   listaCategorias.innerHTML+=`
   <div class="card">
   <b>${c.val().nome}</b>
   <small>${c.key}</small>
   </div>`;
  });
 });
}

/* ================= PRODUTOS ================= */
function carregarCategoriasSelect(){
 filtroCategoria.innerHTML="<option value=''>Todas</option>";
 pCategoria.innerHTML="";
 db.ref("categorias").once("value").then(s=>{
  s.forEach(c=>{
   filtroCategoria.innerHTML+=`<option value="${c.key}">${c.val().nome}</option>`;
   pCategoria.innerHTML+=`<option value="${c.key}">${c.val().nome}</option>`;
  });
 });
}

function carregarProdutos(){
 listaProdutos.innerHTML="";
 db.ref("produtos").once("value").then(s=>{
  let arr=[];
  s.forEach(p=>arr.push({id:p.key,...p.val()}));
  arr.sort((a,b)=>(a.sku||"").localeCompare(b.sku||""));
  arr.forEach(p=>{
   if(filtroCategoria.value && p.categoria!==filtroCategoria.value) return;
   listaProdutos.innerHTML+=`
   <div class="card" onclick="abrirProduto('${p.id}')">
    <div>
     <b>${p.sku||'â€”'} | ${p.nome}</b><br>
     <small>${p.img?'ðŸŸ¢ Com imagem':'ðŸ”´ Sem imagem'}</small>
    </div>
   </div>`;
  });
 });
}

function abrirProduto(id){
 produtoAtual=id;
 db.ref("produtos/"+id).once("value").then(s=>{
  const p=s.val();
  pNome.value=p.nome||"";
  pSku.value=p.sku||"";
  pPeso.value=p.peso||"";
  pPreco.value=p.preco||"";
  pImg.value=p.img||"";
  pCategoria.value=p.categoria||"";
  renderVariacoes(p.variacoes||{});
  modalProduto.style.display="flex";
 });
}

function renderVariacoes(v){
 variacoesBox.innerHTML="";
 Object.keys(v).forEach(k=>{
  variacoesBox.innerHTML+=`
  <div class="card">
   ${k}
   <button onclick="remVar('${k}')">X</button>
  </div>`;
 });
}

function addVariacao(){
 if(!novaVar.value)return;
 db.ref("produtos/"+produtoAtual+"/variacoes/"+novaVar.value).set(true);
 abrirProduto(produtoAtual);
 novaVar.value="";
}

function remVar(v){
 db.ref("produtos/"+produtoAtual+"/variacoes/"+v).remove();
 abrirProduto(produtoAtual);
}

function salvarProduto(){
 db.ref("produtos/"+produtoAtual).update({
  nome:pNome.value,
  sku:pSku.value,
  peso:pPeso.value,
  preco:pPreco.value,
  img:pImg.value,
  categoria:pCategoria.value
 });
 alert("Produto salvo");
 fecharModal();
 carregarProdutos();
}

function fecharModal(){modalProduto.style.display="none";}
</script>

</body>
</html>
