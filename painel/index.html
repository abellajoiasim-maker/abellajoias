<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Abella | Gestão Inteligente</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#0b0b0b;color:#eee;font-family:Inter,Arial}
.tab{display:none}
.tab.active{display:block}
.card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;padding:12px}
.dot{width:10px;height:10px;border-radius:50%}
.btn{background:#222;border:1px solid #444;padding:6px 10px;border-radius:8px;font-size:12px}
.btn.danger{border-color:#900;color:#f66}
.btn.pause{border-color:#caa85c;color:#caa85c}
</style>
</head>

<body>

<header class="p-4 text-center font-bold text-xl bg-black border-b border-[#222]">
Painel Administrativo • Abella Joias
</header>

<nav class="flex gap-2 p-3 bg-[#111] sticky top-0 z-50 flex-wrap">
<button onclick="tab('empresa',this)" class="btn active">Empresa</button>
<button onclick="tab('categorias',this)" class="btn">Categorias</button>
<button onclick="tab('produtos',this)" class="btn">Produtos</button>
<button onclick="tab('promocoes',this)" class="btn">Promoções</button>
<button onclick="tab('pedidos',this)" class="btn">Pedidos</button>
</nav>

<main class="p-6 max-w-7xl mx-auto space-y-10">

<!-- EMPRESA -->
<section id="empresa" class="tab active">
<div class="card max-w-xl">
<h2 class="font-bold mb-4">Empresa</h2>
<input id="empNome" class="w-full mb-2 p-2 bg-black border" placeholder="Nome">
<input id="empWhats" class="w-full mb-2 p-2 bg-black border" placeholder="WhatsApp">
<input id="empPix" type="number" class="w-full mb-2 p-2 bg-black border" placeholder="Desconto PIX %">
<input id="empParc" type="number" class="w-full mb-4 p-2 bg-black border" placeholder="Parcelas">
<button onclick="salvarEmpresa()" class="w-full bg-[#caa85c] text-black font-bold py-2 rounded">SALVAR</button>
</div>
</section>

<!-- CATEGORIAS -->
<section id="categorias" class="tab">
<h2 class="mb-4 font-bold text-xl">Categorias</h2>
<div id="listaCategorias" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
</section>

<!-- PRODUTOS -->
<section id="produtos" class="tab">
<h2 class="mb-4 font-bold text-xl">Produtos por Categoria</h2>
<div id="produtosPorCategoria" class="space-y-10"></div>
</section>

<!-- PROMOÇÕES (SEU BLOCO) -->
<section id="promocoes" class="tab">
<h2 class="mb-4 font-bold text-xl text-[#caa85c]">Promoções por Categoria</h2>
<div class="bg-[#141414] border border-[#2a2a2a] rounded-2xl p-6 max-w-2xl">
<div id="listaPromos" class="space-y-3"></div>
<button class="w-full mt-6 bg-[#caa85c] text-black font-bold py-3 rounded-xl shadow-lg" onclick="salvarPromos()">APLICAR DESCONTOS AGORA</button>
</div>
</section>

<!-- PEDIDOS (SEU BLOCO) -->
<section id="pedidos" class="tab">
<h2 class="mb-4 font-bold">Gestão de Pedidos</h2>
<div id="containerPedidos" class="space-y-4"></div>
</section>

</main>

<script>
firebase.initializeApp({
apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
authDomain:"catalogo-abella-joias.firebaseapp.com",
databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com",
projectId:"catalogo-abella-joias",
storageBucket:"catalogo-abella-joias.firebasestorage.app",
messagingSenderId:"727568435294",
appId:"1:727568435294:web:442c0179ecf0686dff4ccf"
});
const db=firebase.database();

/* NAV */
function tab(id,el){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('nav .btn').forEach(b=>b.classList.remove('active'));
document.getElementById(id).classList.add('active');
el.classList.add('active');
}

/* EMPRESA */
db.ref('settings').on('value',s=>{
const v=s.val()||{};
empNome.value=v.nome||'';
empWhats.value=v.whatsapp||'';
empPix.value=v.pix||0;
empParc.value=v.parcelas||1;
});
function salvarEmpresa(){
db.ref('settings').update({
nome:empNome.value,
whatsapp:empWhats.value,
pix:+empPix.value,
parcelas:+empParc.value
});
alert("Salvo!");
}

/* CATEGORIAS */
db.ref('categories').on('value',snap=>{
listaCategorias.innerHTML='';
listaPromos.innerHTML='';
snap.forEach(c=>{
const d=c.val();
listaCategorias.innerHTML+=`
<div class="card">
<div class="flex justify-between items-center mb-2">
<strong>${d.name}</strong>
<span class="dot ${d.image?'bg-green-500':'bg-red-500'}"></span>
</div>
<div class="flex gap-2">
<button class="btn">Editar</button>
<button class="btn pause">Pausar</button>
<button class="btn danger">Excluir</button>
</div>
</div>`;

listaPromos.innerHTML+=`
<div class="flex justify-between items-center bg-[#111] p-3 rounded-lg border border-[#222]">
<span class="text-xs font-bold uppercase">${d.name}</span>
<div class="flex items-center gap-2">
<input type="number" id="inputPromo-${c.key}" class="w-16 bg-[#000] border text-center p-1 rounded text-[#1f3]" value="${d.discount||0}">
<span class="text-[#caa85c] font-bold">% OFF</span>
</div>
</div>`;
});
});

/* PRODUTOS */
db.ref('products').on('value',snap=>{
const map={};
snap.forEach(p=>{
const v=p.val();
if(!map[v.category]) map[v.category]=[];
map[v.category].push(v);
});
const area=document.getElementById('produtosPorCategoria');
area.innerHTML='';
Object.keys(map).sort().forEach(cat=>{
const lista=map[cat].sort((a,b)=>(a.sku||'').localeCompare(b.sku||''));
let html=`<h3 class="font-bold text-lg">${cat}</h3>
<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">`;
lista.forEach(p=>{
html+=`
<div class="card">
<div class="flex justify-between mb-1">
<strong class="text-xs">${p.sku}</strong>
<span class="dot ${p.image?'bg-green-500':'bg-red-500'}"></span>
</div>
<div class="text-xs mb-1">${p.name}</div>
<div class="text-xs opacity-60">Peso: ${p.weight||'-'}</div>
<div class="flex gap-1 mt-2">
<button class="btn">Editar</button>
<button class="btn pause">Pausar</button>
<button class="btn danger">Excluir</button>
</div>
</div>`;
});
html+='</div>';
area.innerHTML+=html;
});
});

/* PROMOS */
function salvarPromos(){
document.querySelectorAll('[id^="inputPromo-"]').forEach(i=>{
const id=i.id.replace('inputPromo-','');
db.ref('categories/'+id).update({discount:+i.value});
});
alert("Promoções atualizadas!");
}

/* PEDIDOS */
db.ref('orders').on('value',snap=>{
containerPedidos.innerHTML='';
snap.forEach(o=>{
const v=o.val();
containerPedidos.innerHTML+=`
<div class="card border-l-4 ${v.status==='Enviado'?'border-green-500':'border-yellow-500'}">
<div class="flex justify-between">
<div>
<div class="text-[10px] opacity-50">PEDIDO #${o.key.slice(-5)}</div>
<div class="font-bold text-sm">${v.customer?.name||'-'}</div>
<div class="text-[10px] italic">${v.status||'Pendente'}</div>
</div>
<div class="flex flex-col gap-2">
<button class="btn">Visualizar</button>
<button class="btn pause" onclick="atualizarStatus('${o.key}')">Status</button>
<button class="btn danger" onclick="db.ref('orders/${o.key}').remove()">Excluir</button>
</div>
</div>
</div>`;
});
});
function atualizarStatus(id){
const s=prompt("Novo status:");
if(s) db.ref('orders/'+id).update({status:s});
}
</script>

</body>
</html>
