<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Abella Joias</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { background:#F8F6F2; font-family: sans-serif; }
        .serif { font-family: 'Cinzel', serif; }
        .gold { color: #A68966; }
        /* Garantia de que as abas começam escondidas */
        .tab-panel { display: none; } 
        .tab-panel.active { display: block !important; }
        .nav-btn { padding: 12px 20px; font-size: 12px; font-weight: bold; border-bottom: 3px solid transparent; transition: 0.2s; cursor: pointer; }
        .nav-btn.active { color: #A68966; border-bottom-color: #A68966; background: #fff; }
        input, select { border: 1px solid #ddd; padding: 12px; border-radius: 8px; width: 100%; margin-bottom: 10px; }
    </style>
</head>
<body>

<header class="bg-white border-b sticky top-0 z-[100] px-6">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center py-4">
        <div class="mb-4 md:mb-0">
            <h1 class="serif text-xl gold uppercase tracking-widest">Abella Joias</h1>
            <p class="text-[9px] text-gray-400 font-bold">PAINEL ADMINISTRATIVO</p>
        </div>
        <nav class="flex gap-2">
            <div onclick="switchTab('aba-empresa', this)" class="nav-btn active">EMPRESA</div>
            <div onclick="switchTab('aba-categorias', this)" class="nav-btn">CATEGORIAS</div>
            <div onclick="switchTab('aba-produtos', this)" class="nav-btn">PRODUTOS</div>
            <div onclick="switchTab('aba-pedidos', this)" class="nav-btn">PEDIDOS</div>
        </nav>
    </div>
</header>

<main class="max-w-7xl mx-auto p-6">

    <div id="aba-empresa" class="tab-panel active">
        <h2 class="serif text-2xl gold mb-6">Configurações da Loja</h2>
        <div class="bg-white p-6 rounded-xl border grid md:grid-cols-2 gap-4">
            <div><label class="text-xs font-bold text-gray-500 uppercase">Nome da Loja</label><input id="empNome"></div>
            <div><label class="text-xs font-bold text-gray-500 uppercase">WhatsApp (Ex: 5511999999999)</label><input id="empWhats"></div>
            <div><label class="text-xs font-bold text-gray-500 uppercase">Desconto PIX (%)</label><input id="empPix" type="number"></div>
            <div><label class="text-xs font-bold text-gray-500 uppercase">Parcelas s/ Juros</label><input id="empParc" type="number"></div>
            <button onclick="saveEmpresa()" class="md:col-span-2 bg-[#A68966] text-white py-4 rounded-lg font-bold">SALVAR CONFIGURAÇÕES</button>
        </div>
    </div>

    <div id="aba-categorias" class="tab-panel">
        <h2 class="serif text-2xl gold mb-6">Gerir Categorias</h2>
        <div class="bg-white p-6 rounded-xl border flex flex-col md:flex-row gap-4 items-end mb-8">
            <input type="hidden" id="editCatId">
            <div class="flex-1"><label class="text-xs font-bold text-gray-500">NOME</label><input id="catNome"></div>
            <div class="flex-1"><label class="text-xs font-bold text-gray-500">URL IMAGEM</label><input id="catImg"></div>
            <button onclick="saveCategoria()" class="bg-black text-white px-8 py-3.5 rounded-lg font-bold">SALVAR</button>
        </div>
        <div id="gridCats" class="grid grid-cols-2 md:grid-cols-6 gap-4"></div>
    </div>

    <div id="aba-produtos" class="tab-panel">
        <h2 class="serif text-2xl gold mb-6">Gerir Produtos</h2>
        <div class="bg-white p-6 rounded-xl border mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2"><label class="text-xs font-bold text-gray-500">NOME DO PRODUTO</label><input id="pNome"></div>
                <div><label class="text-xs font-bold text-gray-500">SKU</label><input id="pSku"></div>
                <div><label class="text-xs font-bold text-gray-500">CATEGORIA</label><select id="pCat"></select></div>
                <div><label class="text-xs font-bold text-gray-500">PREÇO BRUTO (R$)</label><input id="pPreco" type="number" step="0.01"></div>
                <div><label class="text-xs font-bold text-gray-500">PESO (G)</label><input id="pPeso" type="number" step="0.01"></div>
                <div class="md:col-span-2"><label class="text-xs font-bold text-gray-500">URL DA IMAGEM</label><input id="pImg"></div>
            </div>
            <button onclick="saveProduto()" class="w-full bg-black text-white py-4 rounded-lg font-bold mt-4 uppercase">Salvar Produto</button>
        </div>
        <div id="gridProds" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
    </div>

    <div id="aba-pedidos" class="tab-panel">
        <h2 class="serif text-2xl gold mb-6">Histórico de Pedidos</h2>
        <div id="listaPedidos" class="bg-white p-8 rounded-xl border text-center text-gray-400 italic">
            Nenhum pedido registrado ainda.
        </div>
    </div>

</main>

<script>
// --- CONEXÃO FIREBASE ---
const firebaseConfig = {
    apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
    databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- SISTEMA DE NAVEGAÇÃO (FIXED) ---
function switchTab(abaId, elemento) {
    // 1. Esconder todas as abas
    const todasAbas = document.querySelectorAll('.tab-panel');
    todasAbas.forEach(aba => {
        aba.classList.remove('active');
        aba.style.display = 'none';
    });

    // 2. Remover classe ativa dos botões
    const todosBtns = document.querySelectorAll('.nav-btn');
    todosBtns.forEach(btn => btn.classList.remove('active'));

    // 3. Mostrar a aba clicada
    const abaAtiva = document.getElementById(abaId);
    abaAtiva.classList.add('active');
    abaAtiva.style.display = 'block';

    // 4. Ativar o botão
    elemento.classList.add('active');
}

// --- LOGICA EMPRESA ---
db.ref('settings').on('value', s => {
    const d = s.val() || {};
    document.getElementById('empNome').value = d.nome || '';
    document.getElementById('empWhats').value = d.whatsapp || '';
    document.getElementById('empPix').value = d.pix || 0;
    document.getElementById('empParc').value = d.parcelas || 1;
});
function saveEmpresa() {
    db.ref('settings').update({
        nome: empNome.value, whatsapp: empWhats.value,
        pix: Number(empPix.value), parcelas: Number(empParc.value)
    }).then(() => alert("Configurações salvas!"));
}

// --- LOGICA CATEGORIAS ---
function saveCategoria() {
    const nome = catNome.value;
    if(!nome) return alert("Preencha o nome");
    const id = document.getElementById('editCatId').value || nome.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9]+/g, "-");
    db.ref('categories/' + id).update({ name: nome, image: catImg.value, slug: id });
    catNome.value = catImg.value = document.getElementById('editCatId').value = '';
}
db.ref('categories').on('value', s => {
    const grid = document.getElementById('gridCats');
    const select = document.getElementById('pCat');
    grid.innerHTML = '';
    select.innerHTML = '<option value="">Selecione</option>';
    s.forEach(c => {
        const v = c.val();
        select.innerHTML += `<option value="${v.slug}">${v.name}</option>`;
        grid.innerHTML += `
            <div class="bg-white p-3 border rounded-lg text-center">
                <img src="${v.image || 'https://via.placeholder.com/100'}" class="w-full aspect-square object-cover rounded mb-2">
                <p class="text-[10px] font-bold uppercase truncate">${v.name}</p>
                <button onclick="delCat('${c.key}')" class="text-red-500 text-[9px] font-bold mt-2">EXCLUIR</button>
            </div>`;
    });
});
function delCat(id) { if(confirm("Excluir?")) db.ref('categories/'+id).remove(); }

// --- LOGICA PRODUTOS ---
function saveProduto() {
    const sku = pSku.value.trim();
    if(!sku) return alert("SKU é obrigatório");
    const id = sku.replace(/[\.\$#\[\]\/]/g, "-");
    db.ref('products/' + id).set({
        name: pNome.value, sku: sku, category: pCat.value,
        price: Number(pPreco.value), weight: pPeso.value, image: pImg.value
    }).then(() => { alert("Produto Salvo!"); pNome.value=pSku.value=pPreco.value=pPeso.value=pImg.value=''; });
}
db.ref('products').on('value', s => {
    const grid = document.getElementById('gridProds');
    grid.innerHTML = '';
    let prods = [];
    s.forEach(p => prods.push({id: p.key, ...p.val()}));
    prods.sort((a,b) => a.sku.localeCompare(b.sku));
    prods.forEach(p => {
        grid.innerHTML += `
            <div class="bg-white border rounded shadow-sm">
                <img src="${p.image || 'https://via.placeholder.com/100'}" class="w-full aspect-square object-contain">
                <div class="p-2">
                    <p class="text-[10px] font-bold truncate">${p.name}</p>
                    <p class="text-[9px] text-gray-400">SKU: ${p.sku}</p>
                    <button onclick="delProd('${p.id}')" class="text-red-500 text-[9px] font-bold mt-1">EXCLUIR</button>
                </div>
            </div>`;
    });
});
function delProd(id) { if(confirm("Excluir?")) db.ref('products/'+id).remove(); }
</script>
</body>
</html>
