<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f5f5f5;margin:0}
header{background:#111;color:#fff;padding:12px;font-weight:bold}
nav{display:flex;gap:10px;padding:10px;background:#fff}
nav button{padding:8px 12px;border:0;border-radius:6px;cursor:pointer}
section{display:none;padding:12px}
section.active{display:block}
.card{background:#fff;padding:10px;margin-bottom:8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
.badge{font-size:11px;padding:4px 6px;border-radius:4px}
.green{background:#c6f6d5}
.red{background:#fed7d7}
button.small{font-size:12px;padding:4px 8px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal.show{display:flex}
.modal-box{background:#fff;width:95%;max-width:420px;padding:14px;border-radius:10px}
.modal-box input,.modal-box select{width:100%;margin-bottom:6px;padding:6px}
</style>
</head>
<body>

<header>PAINEL • ABELLA JOIAS</header>

<nav>
<button onclick="openTab('produtos')">Produtos</button>
<button onclick="openTab('categorias')">Categorias</button>
<button onclick="openTab('pedidos')">Pedidos</button>
</nav>

<!-- PRODUTOS -->
<section id="produtos" class="active">
<button onclick="novoProduto()">+ Novo Produto</button>
<div id="listaProdutos"></div>
</section>

<!-- CATEGORIAS -->
<section id="categorias">
<button onclick="novaCategoria()">+ Nova Categoria</button>
<div id="listaCategorias"></div>
</section>

<section id="pedidos">
Pedidos mantidos como estão.
</section>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-box">
<h3 id="mTitulo"></h3>

<img id="mPreview" style="width:100%;height:120px;object-fit:contain;background:#eee;border-radius:6px">

<input id="fNome" placeholder="Nome">
<input id="fSkuBase" placeholder="SKU Base (P-0001)">
<select id="fCategoria"></select>
<select id="fVariacao"></select>
<input id="fPeso" type="number" step="0.01" placeholder="Peso (g)">
<input id="fPreco" type="number" step="0.01" placeholder="Preço">
<input id="fImg" placeholder="URL da imagem">

<label><input type="checkbox" id="fPause"> Pausar</label>

<button onclick="salvar()">Salvar</button>
<button onclick="fechar()">Cancelar</button>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
  storageBucket: "catalogo-abella-joias.firebasestorage.app",
  messagingSenderId: "727568435294",
  appId: "1:727568435294:web:442c0179ecf0686dff4ccf"
});

const db = firebase.database();
let editId = null;

function openTab(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function fechar(){document.getElementById("modal").classList.remove("show");}

async function carregarCategorias(select, atual){
  const snap = await db.ref("categories").once("value");
  select.innerHTML = '<option value="">Categoria</option>';
  snap.forEach(c=>{
    select.innerHTML += `<option value="${c.key}" ${c.key===atual?'selected':''}>${c.val().name}</option>`;
  });
}

async function carregarVariacoes(cat, select, atual){
  select.innerHTML='<option value="">Variação</option>';
  if(!cat) return;
  const snap = await db.ref("categories/"+cat+"/variacoes").once("value");
  snap.forEach(v=>{
    if(v.val().ativo){
      select.innerHTML+=`<option value="${v.key}" ${v.key===atual?'selected':''}>${v.val().nome}</option>`;
    }
  });
}

function novoProduto(){
  editId=null;
  mTitulo.innerText="Novo Produto";
  modal.classList.add("show");
  carregarCategorias(fCategoria);
}

function salvar(){
  const skuBase=fSkuBase.value.trim();
  const variacao=fVariacao.value;
  if(!skuBase||!variacao){alert("SKU e variação obrigatórios");return;}

  const sku=skuBase+"/"+variacao;
  const id=sku.replace(/[^\w\-\/]/g,"-");

  db.ref("products/"+id).set({
    name:fNome.value,
    skuBase,
    sku,
    category:fCategoria.value,
    variation:variacao,
    weight:Number(fPeso.value),
    price:Number(fPreco.value),
    image:fImg.value,
    paused:fPause.checked
  });

  fechar();listarProdutos();
}

async function listarProdutos(){
  const el=document.getElementById("listaProdutos");
  el.innerHTML="";
  const snap=await db.ref("products").once("value");
  const produtos=[];
  snap.forEach(p=>produtos.push(p.val()));
  produtos.sort((a,b)=>a.sku.localeCompare(b.sku));

  produtos.forEach(p=>{
    el.innerHTML+=`
    <div class="card">
      <div>
        <b>${p.sku}</b><br>
        ${p.name}
      </div>
      <span class="badge ${p.image?'green':'red'}">${p.image?'IMG':'SEM IMG'}</span>
    </div>`;
  });
}

async function novaCategoria(){
  const nome=prompt("Nome da categoria");
  if(!nome)return;
  const slug=nome.toLowerCase().replace(/\s+/g,"-");
  await db.ref("categories/"+slug).set({name:nome});
}

listarProdutos();
</script>
</body>
</html>
