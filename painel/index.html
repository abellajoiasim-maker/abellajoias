<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin â€” Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0 }
header { background:#000; color:#fff; padding:15px; text-align:center }
section { padding:20px }
.category { margin-bottom:25px }
.product-card {
  background:#fff;
  padding:10px 15px;
  border-radius:6px;
  margin:6px 0;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.product-card:hover { background:#eee }
.modal {
  position:fixed; inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-content {
  background:#fff;
  width:95%;
  max-width:520px;
  padding:20px;
  border-radius:8px;
}
input, select, button {
  width:100%; padding:8px; margin-top:6px
}
.variation {
  display:flex; gap:6px; margin-top:6px
}
.variation button { width:auto }
.close { background:red; color:#fff }
</style>
</head>

<body>

<header>
<h2>Painel Admin â€” Produtos</h2>
</header>

<section id="products"></section>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>

    <input id="name" placeholder="Nome do produto">
    <input id="skuBase" placeholder="SKU Base (ex: P-0001)">
    <input id="price" type="number" step="0.01" placeholder="PreÃ§o">
    <input id="weight" type="number" step="0.01" placeholder="Peso (g)">

    <select id="category"></select>

    <img id="image" style="width:100%; margin-top:10px">

    <h4>VariaÃ§Ãµes</h4>
    <div id="variations"></div>

    <input id="newVar" placeholder="Nova variaÃ§Ã£o (A, Jesus)">
    <button onclick="addVariation()">Adicionar variaÃ§Ã£o</button>

    <button onclick="saveProduct()">Salvar</button>
    <button onclick="deleteProduct()">Excluir</button>
    <button class="close" onclick="closeModal()">Fechar</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
  storageBucket: "catalogo-abella-joias.firebasestorage.app",
  messagingSenderId: "727568435294",
  appId: "1:727568435294:web:442c0179ecf0686dff4ccf"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let productsData = {};
let currentId = null;

const productsEl = document.getElementById("products");

db.ref("products").on("value", snap => {
  productsData = snap.val() || {};
  render();
});

function render() {
  productsEl.innerHTML = "";
  const grouped = {};

  Object.entries(productsData).forEach(([id,p])=>{
    grouped[p.category] ??= [];
    grouped[p.category].push({id,...p});
  });

  Object.keys(grouped).forEach(cat=>{
    const div = document.createElement("div");
    div.className="category";
    div.innerHTML = `<h3>${cat}</h3>`;
    grouped[cat]
      .sort((a,b)=>a.skuBase.localeCompare(b.skuBase))
      .forEach(p=>{
        const card = document.createElement("div");
        card.className="product-card";
        card.innerHTML = `<strong>${p.skuBase}</strong><span>${p.name}</span>`;
        card.onclick=()=>openModal(p.id);
        div.appendChild(card);
      });
    productsEl.appendChild(div);
  });
}

function openModal(id){
  currentId=id;
  const p=productsData[id];
  modal.style.display="flex";
  modalTitle.innerText=p.name;
  name.value=p.name;
  skuBase.value=p.skuBase;
  price.value=p.price;
  weight.value=p.weight;
  category.value=p.category;
  image.src=p.image||"";
  renderVariations(p.variations||{});
}

function renderVariations(vars){
  variations.innerHTML="";
  Object.entries(vars).forEach(([k,v])=>{
    const div=document.createElement("div");
    div.className="variation";
    div.innerHTML=`
      <input value="${k}" disabled>
      <button onclick="toggleVar('${k}')">${v.active?"Ativo":"Inativo"}</button>
      <button onclick="removeVar('${k}')">ðŸ—‘</button>`;
    variations.appendChild(div);
  });
}

function addVariation(){
  const v=newVar.value.trim();
  if(!v)return;
  productsData[currentId].variations ??= {};
  productsData[currentId].variations[v]={label:v,active:true};
  newVar.value="";
  renderVariations(productsData[currentId].variations);
}

function toggleVar(k){
  const v=productsData[currentId].variations[k];
  v.active=!v.active;
  renderVariations(productsData[currentId].variations);
}

function removeVar(k){
  delete productsData[currentId].variations[k];
  renderVariations(productsData[currentId].variations);
}

function saveProduct(){
  const p=productsData[currentId];
  p.name=name.value;
  p.skuBase=skuBase.value;
  p.price=Number(price.value);
  p.weight=Number(weight.value);
  p.category=category.value;
  db.ref("products/"+currentId).set(p);
  closeModal();
}

function deleteProduct(){
  if(confirm("Excluir produto?")){
    db.ref("products/"+currentId).remove();
    closeModal();
  }
}

function closeModal(){
  modal.style.display="none";
}
</script>

</body>
</html>
