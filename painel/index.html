<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo | Abella Joias</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body{background:#F8F6F2}
        .font-serif{font-family:'Cinzel',serif}
        .gold{color:#A68966}
        .tab{display:none}
        .tab.active{display:block}
        .image-container{ aspect-ratio:1/1; background:#fff; display:flex; align-items:center; justify-content:center; overflow:hidden; }
        .image-container img{max-width:100%; max-height:100%; object-fit:cover}
    </style>
</head>
<body>

<header class="bg-white border-b px-10 py-6 flex justify-between items-center">
    <div>
        <h1 class="font-serif text-xl tracking-widest gold">Abella Joias</h1>
        <p class="text-xs tracking-widest text-gray-400 uppercase">Painel Administrativo</p>
    </div>
    <nav class="flex gap-6 text-xs tracking-widest uppercase font-bold">
        <button onclick="openTab('empresa')" class="hover:text-[#A68966]">Empresa</button>
        <button onclick="openTab('categorias')" class="hover:text-[#A68966]">Categorias</button>
        <button onclick="openTab('produtos')" class="hover:text-[#A68966]">Produtos</button>
    </nav>
</header>

<main class="max-w-7xl mx-auto p-8">

    <section id="empresa" class="tab active space-y-6">
        <h2 class="font-serif text-2xl gold border-b pb-2">Configurações da Empresa</h2>
        <div class="bg-white border p-6 grid md:grid-cols-2 gap-4">
            <div><label class="text-xs text-gray-400">Nome da Loja</label><input id="empNome" class="w-full border p-3"></div>
            <div><label class="text-xs text-gray-400">WhatsApp (com DDD)</label><input id="empWhatsapp" class="w-full border p-3"></div>
            <div><label class="text-xs text-gray-400">Desconto PIX (%)</label><input id="empPix" type="number" class="w-full border p-3"></div>
            <div><label class="text-xs text-gray-400">Qtd Parcelas sem Juros</label><input id="empParcelas" type="number" class="w-full border p-3"></div>
        </div>
        <button onclick="salvarEmpresa()" class="bg-black text-white px-8 py-3 text-xs tracking-widest">SALVAR CONFIGURAÇÕES</button>
    </section>

    <section id="categorias" class="tab space-y-6">
        <h2 class="font-serif text-2xl gold border-b pb-2">Categorias</h2>
        <div class="bg-white border p-6 grid md:grid-cols-3 gap-4 items-end">
            <input id="catNome" placeholder="Nome da categoria" class="border p-3">
            <input id="catImagem" placeholder="URL da Imagem (Capa)" class="border p-3">
            <button onclick="salvarCategoria()" class="bg-black text-white p-3 text-xs">SALVAR CATEGORIA</button>
        </div>
        <div id="listaCategorias" class="grid grid-cols-2 md:grid-cols-5 gap-4 mt-6"></div>
    </section>

    <section id="produtos" class="tab space-y-6">
        <h2 class="font-serif text-2xl gold border-b pb-2">Produtos</h2>
        <div id="listaProdutos" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
    </section>

</main>

<script>
    firebase.initializeApp({
        apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
        databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com"
    });
    const db = firebase.database();

    function openTab(id){
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // GESTÃO EMPRESA
    let config = { pix: 0, parcelas: 1 };
    db.ref('settings').on('value', s => {
        if(s.exists()){
            config = s.val();
            document.getElementById('empNome').value = config.nome || '';
            document.getElementById('empWhatsapp').value = config.whatsapp || '';
            document.getElementById('empPix').value = config.pix || 0;
            document.getElementById('empParcelas').value = config.parcelas || 1;
        }
    });

    function salvarEmpresa(){
        db.ref('settings').update({
            nome: empNome.value,
            whatsapp: empWhatsapp.value,
            pix: Number(empPix.value),
            parcelas: Number(empParcelas.value)
        });
        alert("Configurações atualizadas!");
    }

    // GESTÃO CATEGORIAS
    db.ref('categories').on('value', s => {
        const list = document.getElementById('listaCategorias');
        list.innerHTML = '';
        let cats = [];
        s.forEach(c => { cats.push({id: c.key, ...c.val()}); });
        cats.sort((a,b) => a.name.localeCompare(b.name));

        cats.forEach(v => {
            list.innerHTML += `
            <div class="bg-white border p-3 text-center">
                <img src="${v.image || 'https://via.placeholder.com/150'}" class="w-full aspect-square object-cover mb-2">
                <p class="font-bold text-xs uppercase">${v.name}</p>
                <button onclick="excluirCat('${v.id}')" class="text-red-500 text-[10px] mt-2 block w-full">Excluir</button>
            </div>`;
        });
    });

    function salvarCategoria(){
        const slug = catNome.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9]+/g, "-");
        db.ref('categories/' + slug).set({ name: catNome.value, image: catImagem.value, slug: slug });
        catNome.value = catImagem.value = '';
    }

    // GESTÃO PRODUTOS (ORDEM SKU)
    db.ref('products').on('value', s => {
        const list = document.getElementById('listaProdutos');
        list.innerHTML = '';
        let prods = [];
        s.forEach(p => { prods.push({id: p.key, ...p.val()}); });
        prods.sort((a,b) => a.sku.localeCompare(b.sku));

        prods.forEach(p => {
            const vPix = p.price * (1 - (config.pix/100));
            list.innerHTML += `
            <div class="bg-white border rounded shadow-sm overflow-hidden">
                <div class="image-container"><img src="${p.image || '../assets/img/produtos/'+p.sku+'.jpg'}" onerror="this.src='https://via.placeholder.com/300?text=Sem+Foto'"></div>
                <div class="p-3 space-y-1">
                    <p class="text-[10px] text-gray-400 font-bold uppercase">${p.category}</p>
                    <p class="text-[11px] font-medium h-8 overflow-hidden">${p.name}</p>
                    <p class="text-[10px] bg-gray-100 inline-block px-1">SKU: ${p.sku}</p>
                    <div class="pt-2">
                        <p class="text-[10px] text-gray-400 line-through">De: R$ ${p.price.toFixed(2)}</p>
                        <p class="gold font-bold text-sm">R$ ${vPix.toFixed(2)} <small class="text-gray-400 text-[9px]">(PIX)</small></p>
                    </div>
                </div>
            </div>`;
        });
    });
</script>
</body>
</html>
