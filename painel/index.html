<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin â€” Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f4f4f4}
header{background:#000;color:#fff;padding:15px;text-align:center}
section{padding:20px}
h3{margin-top:30px}
.product-card{
  background:#fff;
  border-radius:6px;
  padding:10px 15px;
  margin:6px 0;
  display:flex;
  justify-content:space-between;
  cursor:pointer;
}
.product-card:hover{background:#eee}
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.modal-content{
  background:#fff;
  width:95%;
  max-width:520px;
  padding:20px;
  border-radius:10px;
}
input,select,button{
  width:100%;
  padding:8px;
  margin-top:8px;
}
.variation{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.variation input{flex:1}
.variation button{width:auto}
button{cursor:pointer}
.close{background:#c00;color:#fff}
.delete{background:#000;color:#fff}
.pause{background:#777;color:#fff}
</style>
</head>

<body>

<header>
  <h2>Painel Administrativo â€” Produtos</h2>
</header>

<section id="products"></section>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>

    <input id="pNome" placeholder="Nome do produto">
    <input id="pSku" placeholder="SKU Base (ex: P-0001)">
    <input id="pPreco" type="number" step="0.01" placeholder="PreÃ§o">
    <input id="pPeso" type="number" step="0.01" placeholder="Peso (g)">

    <select id="pCategoria"></select>

    <img id="pImagem" style="width:100%;margin-top:10px;display:none">

    <h4>VariaÃ§Ãµes</h4>
    <div id="variacoes"></div>

    <input id="novaVar" placeholder="Nova variaÃ§Ã£o (A, Jesus)">
    <button onclick="addVariacao()">Adicionar variaÃ§Ã£o</button>

    <button onclick="salvar()">Salvar</button>
    <button class="pause" onclick="alternarAtivo()">Pausar / Ativar</button>
    <button class="delete" onclick="excluir()">Excluir</button>
    <button class="close" onclick="fechar()">Fechar</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE CONFIG â€” SEUS DADOS */
const firebaseConfig = {
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
  storageBucket: "catalogo-abella-joias.firebasestorage.app",
  messagingSenderId: "727568435294",
  appId: "1:727568435294:web:442c0179ecf0686dff4ccf"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* VARIÃVEIS */
let produtos = {};
let categorias = {};
let atual = null;

const lista = document.getElementById("products");

/* CATEGORIAS */
db.ref("categorias").on("value", s=>{
  categorias = s.val() || {};
  pCategoria.innerHTML = "";
  Object.keys(categorias).forEach(c=>{
    const o=document.createElement("option");
    o.value=c;
    o.textContent=c;
    pCategoria.appendChild(o);
  });
});

/* PRODUTOS */
db.ref("products").on("value", s=>{
  produtos = s.val() || {};
  render();
});

function render(){
  lista.innerHTML="";
  const agrupado={};

  Object.entries(produtos).forEach(([id,p])=>{
    if(!p.categoria)return;
    agrupado[p.categoria]??=[];
    agrupado[p.categoria].push({id,...p});
  });

  Object.keys(agrupado).forEach(cat=>{
    const h=document.createElement("h3");
    h.textContent=cat;
    lista.appendChild(h);

    agrupado[cat]
      .sort((a,b)=>a.skuBase.localeCompare(b.skuBase))
      .forEach(p=>{
        const d=document.createElement("div");
        d.className="product-card";
        d.innerHTML=`<strong>${p.skuBase}</strong><span>${p.nome}</span>`;
        d.onclick=()=>abrir(p.id);
        lista.appendChild(d);
      });
  });
}

function abrir(id){
  atual=id;
  const p=produtos[id];
  modal.style.display="flex";

  modalTitle.textContent=p.nome;
  pNome.value=p.nome||"";
  pSku.value=p.skuBase||"";
  pPreco.value=p.preco||0;
  pPeso.value=p.peso||0;
  pCategoria.value=p.categoria||"";

  if(p.img){
    pImagem.src=p.img;
    pImagem.style.display="block";
  }else{
    pImagem.style.display="none";
  }

  renderVariacoes(p.variacoes||{});
}

function renderVariacoes(v){
  variacoes.innerHTML="";
  Object.entries(v).forEach(([k,val])=>{
    const d=document.createElement("div");
    d.className="variation";
    d.innerHTML=`
      <input value="${k}" disabled>
      <button onclick="toggleVar('${k}')">${val.ativo?"Ativo":"Inativo"}</button>
      <button onclick="removerVar('${k}')">ðŸ—‘</button>
    `;
    variacoes.appendChild(d);
  });
}

function addVariacao(){
  const v=novaVar.value.trim();
  if(!v)return;
  produtos[atual].variacoes??={};
  produtos[atual].variacoes[v]={ativo:true};
  novaVar.value="";
  renderVariacoes(produtos[atual].variacoes);
}

function toggleVar(k){
  produtos[atual].variacoes[k].ativo=!produtos[atual].variacoes[k].ativo;
  renderVariacoes(produtos[atual].variacoes);
}

function removerVar(k){
  delete produtos[atual].variacoes[k];
  renderVariacoes(produtos[atual].variacoes);
}

function salvar(){
  const p=produtos[atual];
  p.nome=pNome.value;
  p.skuBase=pSku.value;
  p.preco=Number(pPreco.value);
  p.peso=Number(pPeso.value);
  p.categoria=pCategoria.value;
  p.ativo = p.ativo !== false;

  db.ref("products/"+atual).set(p);
  fechar();
}

function alternarAtivo(){
  produtos[atual].ativo=!produtos[atual].ativo;
  salvar();
}

function excluir(){
  if(confirm("Excluir produto?")){
    db.ref("products/"+atual).remove();
    fechar();
  }
}

function fechar(){
  modal.style.display="none";
}
</script>

</body>
</html>
