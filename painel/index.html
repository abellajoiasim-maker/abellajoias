<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Administrativo | Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<style>
body{background:#F8F6F2}
.font-serif{font-family:'Cinzel',serif}
.gold{color:#A68966}
.tab{display:none}
.tab.active{display:block}
img.square{aspect-ratio:1/1;object-fit:contain}
.log-ok{color:#047857}
.log-err{color:#b91c1c}
</style>
</head>

<body>

<header class="bg-white border-b px-10 py-6 flex justify-between">
  <div>
    <h1 class="font-serif text-xl tracking-widest gold">Abella Joias</h1>
    <p class="text-xs tracking-widest text-gray-400 uppercase">Painel Administrativo</p>
  </div>

  <nav class="flex gap-6 text-xs uppercase tracking-widest">
    <button onclick="openTab('empresa')" class="gold">Empresa</button>
    <button onclick="openTab('categorias')">Categorias</button>
    <button onclick="openTab('produtos')">Produtos</button>
    <button onclick="openTab('importacao')" class="font-bold">Importa√ß√£o CSV</button>
    <button onclick="openTab('pedidos')">Pedidos</button>
  </nav>
</header>

<main class="max-w-7xl mx-auto p-8 space-y-16">

<!-- IMPORTA√á√ÉO CSV -->
<section id="importacao" class="tab active space-y-6">
<h2 class="font-serif text-2xl gold">Importa√ß√£o de Produtos (CSV)</h2>

<div class="bg-white border p-6 space-y-4">
<p class="text-sm text-gray-600">
üì• Envie um arquivo CSV usando <b>;</b> como separador<br>
Cabe√ßalho obrigat√≥rio:
</p>

<pre class="bg-gray-100 p-3 text-xs">tipo;nome;sku;categoria;preco;peso;imagem;variacoes</pre>

<input type="file" id="csvFile" accept=".csv" class="border p-3 w-full">

<button onclick="importarCSV()" class="bg-green-600 text-white px-6 py-3">
IMPORTAR PRODUTOS
</button>

<div id="importStatus" class="text-sm mt-4"></div>
<div id="importLog" class="text-xs mt-4 space-y-1"></div>
</div>
</section>

</main>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
   authDomain: "catalogo-abella-joias.firebaseapp.com",
 databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
});
const db = firebase.database();

function openTab(id){
 document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}

function importarCSV(){
 const file = document.getElementById('csvFile').files[0];
 const status = document.getElementById('importStatus');
 const log = document.getElementById('importLog');

 log.innerHTML='';
 status.innerHTML='';

 if(!file){
  status.innerHTML='<span class="log-err">‚ùå Nenhum arquivo selecionado</span>';
  return;
 }

 status.innerHTML='‚è≥ Lendo arquivo...';

 const reader = new FileReader();

 reader.onerror = ()=>{
  status.innerHTML='<span class="log-err">‚ùå Erro ao ler o arquivo</span>';
 };

 reader.onload = (e)=>{
  const texto = e.target.result.replace(/\r/g,'').trim();
  const linhas = texto.split('\n');

  if(linhas.length < 2){
   status.innerHTML='<span class="log-err">‚ùå CSV vazio ou inv√°lido</span>';
   return;
  }

  const cabecalho = linhas[0].toLowerCase().trim();
  if(!cabecalho.startsWith('tipo;nome;sku;categoria;preco;peso')){
   status.innerHTML='<span class="log-err">‚ùå Cabe√ßalho inv√°lido</span>';
   return;
  }

  let sucesso = 0;
  let erros = 0;

  linhas.slice(1).forEach((linha, index)=>{
   if(!linha.trim()) return;

   const col = linha.split(';');
   if(col.length < 6){
    log.innerHTML+=`<div class="log-err">Linha ${index+2}: colunas insuficientes</div>`;
    erros++;
    return;
   }

   const produto = {
    type: col[0],
    name: col[1],
    sku: col[2],
    category: col[3],
    price: Number(col[4]),
    weight: Number(col[5]),
    image: col[6] || ''
   };

   if(produto.type === 'variacao'){
    produto.variacoes = (col[7]||'').split('|');
   }

   db.ref('products').push(produto);
   sucesso++;
   log.innerHTML+=`<div class="log-ok">‚úî ${produto.name} (${produto.sku})</div>`;
  });

  status.innerHTML = `
   <b>‚úÖ Importa√ß√£o finalizada</b><br>
   Produtos importados: ${sucesso}<br>
   Erros: ${erros}
  `;
 };

 reader.readAsText(file,'UTF-8');
}
</script>

</body>
</html>

