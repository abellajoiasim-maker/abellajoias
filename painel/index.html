<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin • Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{background:#0b0b0b;color:#eee;font-family:Inter,Arial}
.tab{display:none}
.tab.active{display:block}
.card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;padding:12px}
.btn{padding:6px 10px;border-radius:8px;font-size:10px}
.btn-gold{background:#caa85c;color:#000;font-weight:700}
.btn-gray{background:#333}
.btn-red{background:#700}
.dot{width:8px;height:8px;border-radius:999px}
</style>
</head>

<body>

<!-- NAV -->
<nav class="flex sticky top-0 z-50 bg-black border-b border-[#222]">
  <button class="flex-1 p-4" onclick="showTab('empresa')">EMPRESA</button>
  <button class="flex-1 p-4" onclick="showTab('categorias')">CATEGORIAS</button>
  <button class="flex-1 p-4" onclick="showTab('produtos')">PRODUTOS</button>
  <button class="flex-1 p-4" onclick="showTab('promocoes')">PROMOÇÕES</button>
  <button class="flex-1 p-4" onclick="showTab('pedidos')">PEDIDOS</button>
</nav>

<main class="max-w-7xl mx-auto p-6">

<!-- EMPRESA -->
<section id="empresa" class="tab active">
  <div class="card max-w-md">
    <h2 class="font-bold mb-4 text-[#caa85c]">Dados da Empresa</h2>
    <input id="empNome" placeholder="Nome" class="w-full mb-2 p-2 bg-black border">
    <input id="empWhats" placeholder="WhatsApp" class="w-full mb-2 p-2 bg-black border">
    <input id="empPix" type="number" placeholder="Desconto Pix %" class="w-full mb-2 p-2 bg-black border">
    <input id="empParc" type="number" placeholder="Parcelas" class="w-full mb-4 p-2 bg-black border">
    <button class="w-full btn-gold p-3 rounded-xl" onclick="salvarEmpresa()">SALVAR</button>
  </div>
</section>

<!-- CATEGORIAS -->
<section id="categorias" class="tab">
  <button class="btn-gold mb-4" onclick="novaCategoria()">+ Nova Categoria</button>
  <div id="listaCategorias" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
</section>

<!-- PRODUTOS -->
<section id="produtos" class="tab">
  <div id="produtosPorCategoria"></div>
</section>

<!-- PROMOÇÕES -->
<section id="promocoes" class="tab">
  <h2 class="mb-4 font-bold text-[#caa85c]">Promoções por Categoria</h2>
  <div class="card max-w-lg">
    <div id="listaPromos" class="space-y-3"></div>
    <button class="w-full btn-gold mt-4 p-3 rounded-xl" onclick="salvarPromos()">APLICAR DESCONTOS</button>
  </div>
</section>

<!-- PEDIDOS -->
<section id="pedidos" class="tab">
  <div id="containerPedidos" class="space-y-4"></div>
</section>

</main>

<!-- MODAL -->
<div id="modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4">
  <div class="card max-w-md w-full">
    <h3 id="modalTitulo" class="font-bold mb-3"></h3>
    <div id="modalBody"></div>
    <button class="btn-gold w-full mt-4" onclick="salvarModal()">SALVAR</button>
    <button class="btn-gray w-full mt-2" onclick="fecharModal()">FECHAR</button>
  </div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
  authDomain: "catalogo-abella-joias.firebaseapp.com",
  databaseURL: "https://catalogo-abella-joias-default-rtdb.firebaseio.com",
  projectId: "catalogo-abella-joias",
});
const db = firebase.database();

let MODAL_CTX = {};

/* NAV */
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* EMPRESA */
db.ref('settings').on('value',s=>{
  const v=s.val()||{};
  empNome.value=v.nome||'';
  empWhats.value=v.whatsapp||'';
  empPix.value=v.pix||0;
  empParc.value=v.parcelas||1;
});
function salvarEmpresa(){
  db.ref('settings').update({
    nome:empNome.value,
    whatsapp:empWhats.value,
    pix:Number(empPix.value),
    parcelas:Number(empParc.value)
  });
  alert('Empresa salva');
}

/* CATEGORIAS */
db.ref('categories').on('value',snap=>{
  listaCategorias.innerHTML='';
  listaPromos.innerHTML='';
  snap.forEach(c=>{
    const d=c.val();
    listaCategorias.innerHTML+=`
      <div class="card">
        <div class="flex justify-between mb-2">
          <b>${d.name}</b>
          <span class="dot ${d.image?'bg-green-500':'bg-red-500'}"></span>
        </div>
        <div class="flex gap-2 text-[10px]">
          <button class="btn-gold" onclick="editarCategoria('${c.key}')">EDITAR</button>
          <button class="btn-gray" onclick="pausar('categories','${c.key}')">PAUSAR</button>
          <button class="btn-red" onclick="excluir('categories','${c.key}')">EXCLUIR</button>
        </div>
      </div>`;
    listaPromos.innerHTML+=`
      <div class="flex justify-between items-center">
        <span>${d.name}</span>
        <input type="number" id="promo-${c.key}" value="${d.discount||0}" class="w-16 bg-black border p-1 text-center">
      </div>`;
  });
});

/* PRODUTOS */
db.ref('products').on('value',snap=>{
  produtosPorCategoria.innerHTML='';
  const map={};
  snap.forEach(p=>{
    const v=p.val();
    if(!map[v.category]) map[v.category]=[];
    map[v.category].push({id:p.key,...v});
  });
  Object.keys(map).forEach(cat=>{
    const bloco=document.createElement('div');
    bloco.innerHTML=`<h3 class="text-[#caa85c] font-bold mt-6 mb-3">${cat}</h3>
    <div class="grid grid-cols-2 md:grid-cols-6 gap-3"></div>`;
    const grid=bloco.querySelector('div');
    map[cat].sort((a,b)=>(a.sku||'').localeCompare(b.sku||'')).forEach(p=>{
      grid.innerHTML+=`
        <div class="card">
          <div class="flex justify-between">
            <span class="text-[9px]">${p.sku||'-'}</span>
            <span class="dot ${p.image?'bg-green-500':'bg-red-500'}"></span>
          </div>
          <div class="text-[10px] font-bold truncate">${p.name}</div>
          <div class="flex gap-1 mt-2">
            <button class="btn-gold">EDIT</button>
            <button class="btn-gray">PAUSAR</button>
            <button class="btn-red">EXCLUIR</button>
          </div>
        </div>`;
    });
    produtosPorCategoria.appendChild(bloco);
  });
});

/* PROMOS */
function salvarPromos(){
  document.querySelectorAll('[id^="promo-"]').forEach(i=>{
    db.ref('categories/'+i.id.replace('promo-','')).update({discount:Number(i.value)});
  });
  alert('Promoções atualizadas');
}

/* PEDIDOS */
db.ref('orders').on('value',snap=>{
  containerPedidos.innerHTML='';
  snap.forEach(o=>{
    const v=o.val();
    containerPedidos.innerHTML+=`
      <div class="card">
        <b>${v.customer?.name||'Cliente'}</b>
        <div>Status: ${v.status||'Pendente'}</div>
        <div class="flex gap-2 mt-2">
          <button class="btn-gold">ROMANEIO</button>
          <button class="btn-gray" onclick="statusPedido('${o.key}')">STATUS</button>
          <button class="btn-red" onclick="excluir('orders','${o.key}')">EXCLUIR</button>
        </div>
      </div>`;
  });
});
function statusPedido(id){
  const s=prompt('Novo status');
  if(s) db.ref('orders/'+id).update({status:s});
}

/* MODAL (base) */
function fecharModal(){modal.classList.add('hidden')}
function abrirModal(){modal.classList.remove('hidden')}

/* UTIL */
function pausar(path,id){db.ref(path+'/'+id+'/paused').set(true)}
function excluir(path,id){if(confirm('Excluir?')) db.ref(path+'/'+id).remove()}
</script>

</body>
</html>
