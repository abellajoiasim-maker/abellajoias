<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin ‚Ä¢ Abella Joias</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{background:#0b0b0b;color:#eee}
.card{background:#141414;border:1px solid #2a2a2a;border-radius:14px;padding:12px}
.btn{padding:6px 10px;border-radius:8px;font-size:12px}
.btn-gold{background:#caa85c;color:#000;font-weight:700}
.btn-dark{background:#222;border:1px solid #444}
.tag{font-size:10px;padding:3px 7px;border-radius:999px}
.ok{background:#1f3;color:#000}
.no{background:#c33}
</style>
</head>
<body>

<header class="p-4 text-center font-bold text-xl bg-black border-b border-[#222]">
Painel Administrativo ‚Ä¢ Abella Joias
</header>

<nav class="flex flex-wrap gap-2 p-3 bg-[#111] justify-center">
<button onclick="show('empresa')" class="btn btn-dark">Empresa</button>
<button onclick="show('categorias')" class="btn btn-dark">Categorias</button>
<button onclick="show('produtos')" class="btn btn-dark">Produtos</button>
<button onclick="show('promocoes')" class="btn btn-dark">Promo√ß√µes</button>
<button onclick="show('pedidos')" class="btn btn-dark">Pedidos</button>
</nav>

<main class="p-4 max-w-7xl mx-auto">

<!-- EMPRESA -->
<section id="empresa">
<div class="card max-w-md">
<h2 class="font-bold mb-3">Empresa</h2>
<input id="empNome" class="w-full mb-2 p-2 bg-black border" placeholder="Nome">
<input id="empWhats" class="w-full mb-2 p-2 bg-black border" placeholder="WhatsApp">
<input id="empPix" type="number" class="w-full mb-2 p-2 bg-black border" placeholder="Desconto PIX %">
<button class="btn btn-gold w-full" onclick="salvarEmpresa()">Salvar</button>
</div>
</section>

<!-- CATEGORIAS -->
<section id="categorias" class="hidden">
<button class="btn btn-gold mb-4" onclick="novaCategoria()">+ Nova Categoria</button>
<div id="listaCategorias" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
</section>

<!-- PRODUTOS -->
<section id="produtos" class="hidden">
<div id="produtosPorCategoria" class="space-y-6"></div>
</section>

<!-- PROMO√á√ïES -->
<section id="promocoes" class="hidden">
<h2 class="mb-4 font-bold text-xl text-[#caa85c]">Promo√ß√µes por Categoria</h2>
<div class="bg-[#141414] border border-[#2a2a2a] rounded-2xl p-6 max-w-2xl">
<div id="listaPromos" class="space-y-3"></div>
<button class="w-full mt-6 bg-[#caa85c] text-black font-bold py-3 rounded-xl" onclick="salvarPromos()">APLICAR DESCONTOS</button>
</div>
</section>

<!-- PEDIDOS -->
<section id="pedidos" class="hidden">
<h2 class="mb-4 font-bold">Gest√£o de Pedidos</h2>
<div id="containerPedidos" class="space-y-4"></div>
</section>

</main>

<!-- MODAL -->
<div id="modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4">
<div class="bg-[#111] p-4 rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
<h2 id="mTitle" class="font-bold mb-3"></h2>
<div id="mBody"></div>
<button class="btn btn-gold w-full mt-4" onclick="salvarModal()">Salvar</button>
<button class="btn btn-dark w-full mt-2" onclick="fechar()">Fechar</button>
</div>
</div>

<script>
// üî• FIREBASE
firebase.initializeApp({
 apiKey:"AIzaSyDPBZSxW8XjtQmDMUknzAyIlFda51MvMJY",
 authDomain:"catalogo-abella-joias.firebaseapp.com",
 databaseURL:"https://catalogo-abella-joias-default-rtdb.firebaseio.com",
 projectId:"catalogo-abella-joias"
});
const db=firebase.database();
let ctx={};

// NAV
function show(id){
 document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
}

// MODAL
function abrir(){modal.classList.remove('hidden')}
function fechar(){modal.classList.add('hidden')}

// EMPRESA
db.ref('settings').on('value',s=>{
 const v=s.val()||{};
 empNome.value=v.nome||'';
 empWhats.value=v.whatsapp||'';
 empPix.value=v.pix||0;
});
function salvarEmpresa(){
 db.ref('settings').update({
  nome:empNome.value,
  whatsapp:empWhats.value,
  pix:+empPix.value
 });
 alert('Empresa salva');
}

// CATEGORIAS
function novaCategoria(){
 ctx={type:'cat',id:null};
 mTitle.innerText='Nova Categoria';
 mBody.innerHTML=`<input id="catNome" class="w-full p-2 bg-black border" placeholder="Nome da Categoria">`;
 abrir();
}

db.ref('categories').on('value',snap=>{
 listaCategorias.innerHTML='';
 listaPromos.innerHTML='';
 snap.forEach(c=>{
  const d=c.val();
  listaCategorias.innerHTML+=`
  <div class="card">
   <div class="flex justify-between items-center">
    <strong>${d.name}</strong>
    <span class="tag ${d.image?'ok':'no'}">IMG</span>
   </div>
   <div class="text-xs mt-1">${Object.keys(d.variations||{}).length} varia√ß√µes</div>
   <div class="flex gap-2 mt-2">
    <button class="btn btn-dark" onclick="editarCategoria('${c.key}')">Editar</button>
    <button class="btn btn-dark" onclick="excluir('categories','${c.key}')">Excluir</button>
   </div>
  </div>`;

  listaPromos.innerHTML+=`
  <div class="flex justify-between items-center bg-[#111] p-3 rounded-lg border border-[#222]">
   <span class="text-xs font-bold">${d.name}</span>
   <input id="inputPromo-${c.key}" type="number" class="w-16 bg-black border text-center" value="${d.discount||0}">
  </div>`;
 });
});

// EDITAR CATEGORIA + VARIA√á√ïES
function editarCategoria(id){
 ctx={type:'cat',id};
 db.ref('categories/'+id).once('value').then(s=>{
  const v=s.val();
  let vars='';
  Object.entries(v.variations||{}).forEach(([k,x])=>{
   vars+=`
   <div class="flex gap-2 mb-1">
    <input value="${x.name}" onchange="updVar('${id}','${k}',this.value)">
    <input type="checkbox" ${x.active?'checked':''} onchange="toggleVar('${id}','${k}',this.checked)">
    <button onclick="delVar('${id}','${k}')">üóë</button>
   </div>`;
  });
  mTitle.innerText='Editar Categoria';
  mBody.innerHTML=`
   <input id="catNome" class="w-full p-2 bg-black border mb-2" value="${v.name}">
   <h3 class="font-bold mt-2">Varia√ß√µes</h3>
   ${vars}
   <button onclick="novaVar('${id}')" class="btn btn-gold mt-2">+ Nova Varia√ß√£o</button>`;
  abrir();
 });
}

function salvarModal(){
 if(ctx.type==='cat'){
  const nome=document.getElementById('catNome').value;
  if(ctx.id){
   db.ref('categories/'+ctx.id+'/name').set(nome);
  }else{
   db.ref('categories').push({name:nome,variations:{}});
  }
 }
 fechar();
}

function novaVar(cat){
 const k=prompt('Nome da varia√ß√£o (ex: A, DEUS)');
 if(!k)return;
 db.ref(`categories/${cat}/variations/${k}`).set({name:k,active:true});
}
function updVar(cat,key,val){
 db.ref(`categories/${cat}/variations/${key}/name`).set(val);
}
function toggleVar(cat,key,val){
 db.ref(`categories/${cat}/variations/${key}/active`).set(val);
}
function delVar(cat,key){
 if(confirm('Excluir varia√ß√£o?'))
 db.ref(`categories/${cat}/variations/${key}`).remove();
}

function excluir(path,id){
 if(confirm('Excluir item?')) db.ref(path+'/'+id).remove();
}

// PRODUTOS
db.ref('products').on('value',snap=>{
 const map={};
 snap.forEach(p=>{
  const v=p.val();
  if(!map[v.category]) map[v.category]=[];
  map[v.category].push(v);
 });
 produtosPorCategoria.innerHTML='';
 Object.keys(map).sort().forEach(cat=>{
  const lista=map[cat].sort((a,b)=>(a.sku||'').localeCompare(b.sku||''));
  let html=`<h3 class="font-bold mt-4">${cat}</h3>
  <div class="grid grid-cols-2 md:grid-cols-6 gap-3">`;
  lista.forEach(p=>{
   html+=`
   <div class="card">
    <div class="flex justify-between">
     <strong>${p.sku}</strong>
     <span class="tag ${p.image?'ok':'no'}">IMG</span>
    </div>
    <div class="text-xs">${p.name}</div>
   </div>`;
  });
  html+='</div>';
  produtosPorCategoria.innerHTML+=html;
 });
});

// PROMOS
function salvarPromos(){
 document.querySelectorAll('[id^="inputPromo-"]').forEach(i=>{
  const id=i.id.replace('inputPromo-','');
  db.ref('categories/'+id).update({discount:Number(i.value)});
 });
 alert('Promo√ß√µes atualizadas');
}

// PEDIDOS
db.ref('orders').on('value',snap=>{
 containerPedidos.innerHTML='';
 snap.forEach(o=>{
  const v=o.val();
  containerPedidos.innerHTML+=`
  <div class="card">
   <div class="text-xs opacity-50">#${o.key.slice(-5)}</div>
   <div>${v.customer?.name||''}</div>
   <div class="text-xs">${v.status||'Pendente'}</div>
  </div>`;
 });
});
</script>
</body>
</html>
